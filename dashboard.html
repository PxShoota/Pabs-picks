<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PABS PICKS — Dashboard</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="header">
    <div class="brand">
      <div class="logo">PABS PICKS</div>
      <div>
        <div class="tagline">No BS. No Fluff. Just Winners.</div>
      </div>
    </div>
    <div class="header-right">
      <div class="kv">Owner Dashboard</div>
      <a href="settings.html" class="settings-link" style="margin-left:8px">Settings</a>
    </div>
  </div>

  <div class="container grid">
    <div>
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
          <div>
            <div class="title">Today's Picks</div>
            <div class="subtle">High-value slips tailored to your profile</div>
          </div>
          <div>
            <button id="gen" class="btn" disabled>Generate Picks (Coming Soon)</button>
          </div>
        </div>
        <div id="todayList">
          <div class="empty">Loading picks…</div>
        </div>
      </div>

      <div class="card" style="margin-top:18px">
        <div class="title">Yesterday's Picks</div>
        <div class="subtle">Review recent performance</div>
        <div id="yesterdayList" style="margin-top:12px">
          <div class="empty">Loading…</div>
        </div>
      </div>
    </div>

    <div>
      <div class="card">
        <div class="title">Quick Stats</div>
        <div style="margin-top:8px">
          <div class="small">Sports Weighting</div>
          <div style="display:flex;gap:8px;margin-top:8px">
            <div class="kv">NBA 40%</div>
            <div class="kv">NHL 30%</div>
            <div class="kv">NFL 30%</div>
          </div>
          <div style="margin-top:12px" class="small">Default Risk: Smart Upside (+600 to +2000)</div>
        </div>
      </div>

      <div class="card" style="margin-top:18px">
        <div class="title">Notes</div>
        <div class="small" style="margin-top:8px;color:var(--muted)">
          Pabs Picker v1 (UI) — picks are now loaded automatically from your Google Sheet.<br>
          Edit the sheet to update data instantly.
        </div>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="footer">Powered by Pabs</div>
  </div>

<script>
function renderPick(p){
  const legs = p.legs.map(l=>`<div class="legs">• ${l}</div>`).join('');
  const resultBadge = p.result ? (p.result === 'W' ? '<span class="badge-win">W</span>' : '<span class="badge-loss">L</span>') : '';
  return `<div class="slip">
    <div class="slip-left">
      <div class="sport">${p.sport} <span class="small" style="margin-left:8px">${p.type || ''}</span></div>
      ${legs}
      <div style="margin-top:8px" class="small">Confidence: <span class="conf">${p.confidence}%</span></div>
    </div>
    <div style="text-align:right;margin-left:12px">
      <div class="odds">${p.odds}</div>
      <div style="margin-top:8px">${resultBadge}</div>
    </div>
  </div>`;
}

async function loadPicks() {
  try {
    // ✅ Your live Google Sheet link (converted to CSV)
    const sheetUrl = "https://api.allorigins.win/raw?url=https://docs.google.com/spreadsheets/d/e/2PACX-1vSX27zBosVxadB5zYfriEYupqrr_GtDA6vI6FzqH2RPLGf6Ky97wI4l6EYOyEl-7FxtudZi2NeKmF1h/pub?output=csv";

    const response = await fetch(sheetUrl);
    const csvText = await response.text();

    // Convert CSV → structured JSON
    const rows = csvText.trim().split("\n").slice(1);
    const picks = { today: [], yesterday: [], past: [] };

    rows.forEach(row => {
      const [sport, type, legs, odds, confidence, result, section] = row.split(",");
      const pick = {
        sport: sport?.trim(),
        type: type?.trim(),
        legs: legs ? legs.split(";").map(x => x.trim()) : [],
        odds: odds?.trim(),
        confidence: Number(confidence) || 0,
        result: result?.trim() || null
      };
      if (section && picks[section.trim()]) {
        picks[section.trim()].push(pick);
      }
    });

    const t = picks.today || [];
    const y = picks.yesterday || [];
    const tcont = document.getElementById('todayList');
    const ycont = document.getElementById('yesterdayList');

    if (t.length === 0) {
      tcont.innerHTML = '<div class="empty">No picks for today.</div>';
    } else {
      tcont.innerHTML = t.map(renderPick).join('');
    }

    if (y.length === 0) {
      ycont.innerHTML = '<div class="empty">No picks for yesterday.</div>';
    } else {
      ycont.innerHTML = y.map(renderPick).join('');
    }

  } catch (err) {
    document.getElementById('todayList').innerHTML = '<div class="empty">Could not load picks.</div>';
    document.getElementById('yesterdayList').innerHTML = '<div class="empty">Could not load picks.</div>';
    console.error("Error loading Google Sheet:", err);
  }
}

window.addEventListener('load', loadPicks);
</script>
</body>
</html>

